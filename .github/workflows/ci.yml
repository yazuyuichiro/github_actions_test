name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    # æ¯æ—¥åˆå‰9æ™‚ï¼ˆUTCï¼‰ã«è‡ªå‹•å®Ÿè¡Œ = æ—¥æœ¬æ™‚é–“18æ™‚
    - cron: '0 9 * * *'

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: [3.8, 3.9, '3.10', '3.11']

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Create .env file for testing
      run: |
        echo "APP_NAME=GitHub Actions Test App" >> .env
        echo "APP_VERSION=2.1.0" >> .env
        echo "ENVIRONMENT=ci" >> .env
        echo "DEBUG=true" >> .env
        echo "LOG_LEVEL=debug" >> .env
    
    - name: Run Python script
      run: python main.py
    
    - name: Run basic tests
      run: |
        python -c "
        import main
        print('âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸ')
        
        # åŸºæœ¬çš„ãªå‹•ä½œç¢ºèª
        import os
        from dotenv import load_dotenv
        load_dotenv()
        
        assert os.getenv('APP_NAME') == 'GitHub Actions Test App'
        assert os.getenv('ENVIRONMENT') == 'ci'
        print('âœ… ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿ãŒæˆåŠŸã—ã¾ã—ãŸ')
        
        print('ğŸ‰ å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šéã—ã¾ã—ãŸï¼')
        "

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Deploy message
      run: |
        echo "ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™"
        echo "ğŸ“¦ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™å®Œäº†"
        echo "âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆåŠŸï¼" 